<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Keven Villeneuve's personal website">
        <title>Kevenv - Tar file format</title>
        <link rel="icon" href="../imgs/icon.png">
        <link rel="stylesheet" href="../style/style.css">
        <link rel="stylesheet" href="../style/boxicons-2.1.4/css/boxicons.min.css">
<link rel="stylesheet" href="../style/codehilite.css">

    </head>
    <body>
        <header>
            <h1>~/kevenv</h1>
            <nav>
                <a href="../index.html">Home</a>
                <a href="../about.html">About</a>
                <a href="../publications.html">Publications</a>
                <a href="../projects.html">Projects</a>
                <a href="../blog.html">Blog</a>
            </nav>
        </header>
        <hr>
<h1>Tar file format</h1>
<p>On Unix systems, tar (Tape Archive) is a very popular file format to group a hierarchy of files and directories within a single file, otherwise known as an <em>archive</em>.
When compressed using gzip (tar.gz), it can compete with the infamous ZIP file format.
This format can also be used as a simple read-only file system, since it supports Unix file permissions.
In this article we will see how to implement a basic file archiver utility that supports tar files.
In <a href="../blog/gz_format.html">another article</a> we will see how to compress a tar archive using <code>gzip</code> which uses the same compression method as ZIP.</p>
<h2>Format</h2>
<p>A tar archive consists of a series of <em>file entries</em> ending with an <em>end-of-archive</em> entry.
[diagram]
Directories are also represented by a file entry.
The archive is divided into blocks of 512 bytes.</p>
<p>A file entry starts with a <em>header block</em> describing the file and can contain zero or more <em>data blocks</em> which contains the file's content right after. The size taken by a file in the archive might be bigger than its actual size as the smallest unit of allocation is the block, we must round up to the nearest block size.</p>
<p>Unused space in blocks is filled with zeros and the end-of-archive entry is simply two or more consecutive zero-filled blocks.</p>
<p>Note that there are multiple variants of the Tar file format.
The GNU tar utility <code>tar</code> seems to use the "gnu" format by default (which has a different <code>magic</code> + <code>version</code>) even though the documentation mentions that the default should be "posix". However both "posix" and "gnu" are based of the "ustar" format (Unix Standard Tar).
To stay out of this mess we will only support the most popular "ustar" format.</p>
<h3>Header</h3>
<p>The header fits into a single block.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span><span class="w"> </span><span class="n">tar_file_header_t</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span><span class="w"> </span><span class="c1">// absolute file path</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">mode</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span><span class="w"> </span><span class="c1">// file permissions (octal)</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">uid</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span><span class="w"> </span><span class="c1">// user ID (octal)</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">gid</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span><span class="w"> </span><span class="c1">// group ID (octal)</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">size</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span><span class="w"> </span><span class="c1">// file size (octal)</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">mtime</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span><span class="w"> </span><span class="c1">// last modified time (octal)</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">chksum</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span><span class="w"> </span><span class="c1">// checksum of header (octal)</span>
<span class="w">    </span><span class="n">u8</span><span class="w"> </span><span class="n">typeflag</span><span class="p">;</span><span class="w"> </span><span class="c1">// type of file</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">linkname</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span><span class="w"> </span><span class="c1">// absolute file path of the linked-to file</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">magic</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span><span class="w"> </span><span class="c1">// tar file signature &quot;ustar&quot;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">version</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"> </span><span class="c1">// tar format version &quot;00&quot;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">uname</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span><span class="w"> </span><span class="c1">// name of user/owner</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">gname</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span><span class="w"> </span><span class="c1">// name of group</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">devmajor</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span><span class="w"> </span><span class="c1">// device major number (octal)</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">devminor</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span><span class="w"> </span><span class="c1">// device minor number (octal)</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">prefix</span><span class="p">[</span><span class="mi">155</span><span class="p">];</span><span class="w"> </span><span class="c1">// prefix for file path if name &gt; 100</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>

<p>To check the validity of a file entry, the header contains the <code>magic</code> and <code>version</code> field. In the case of the "ustar" format:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#define TAR_MAGIC      &quot;ustar&quot;</span>
<span class="cp">#define TAR_VERSION    &quot;00&quot;</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">tar_is_ustar</span><span class="p">(</span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="w"> </span><span class="n">header</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">memcmp</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">magic</span><span class="p">,</span><span class="w"> </span><span class="n">TAR_MAGIC</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">           </span><span class="n">memcmp</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">TAR_VERSION</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h3>File size</h3>
<p>The weirdest and most annoying thing in the tar file format is that the fields containing numbers in the header are stored in <strong>octal (base 8)</strong> encoded as a null terminated ASCII string. We can use the following function to convert:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">u64</span><span class="w"> </span><span class="nf">tar_oct_to_u64</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">octal_str</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">octal_str</span><span class="p">);</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">u64</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">value</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">        </span><span class="n">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">octal_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<p>The <code>size</code> field stores the size of the file in octal, it is set to zero in case of a directory or special files.</p>
<h3>File path</h3>
<p>Each string in the header is made of ASCII characters and ends when <code>\0</code> is encountered. Note that they are are <strong>not always null terminated</strong>, as the last character can also be part of the string.</p>
<p>The absolute file path is contained in the <code>name</code> field.
If the path is bigger than 100 characters, the <code>prefix</code> must be used and follows the format <code>[prefix]/[name]</code>, for a maximum length of 256 characters (including the <code>/</code>). A prefix must be used if the first character of the <code>prefix</code> field is not <code>\0</code>.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">tar_get_file_path</span><span class="p">(</span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="w"> </span><span class="n">header</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file_path</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// no prefix</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">prefix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">file_path</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// with prefix</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strnlen</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="mi">155</span><span class="p">);</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-&gt;</span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
<span class="w">    </span><span class="n">file_path</span><span class="p">[</span><span class="n">length</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">file_path</span><span class="p">[</span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">header</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">    </span><span class="n">file_path</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h3>File permissions</h3>
<p>The name of the user and group of a file is stored in the <code>uname</code> and <code>gname</code> fields respectively. <code>uid</code> and <code>gid</code> contain the corresponding Unix user ID and group ID in octal.
The <a href="https://en.wikipedia.org/wiki/File-system_permissions#POSIX_permissions">Unix file permissions</a> are stored in the <code>mode</code> field in octal.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//   U: user, G: group, O: other</span>
<span class="c1">//   R: read, W: write, X: execute</span>
<span class="cp">#define TAR_MODE_O_X      (1 &lt;&lt; 0)</span>
<span class="cp">#define TAR_MODE_O_W      (1 &lt;&lt; 1)</span>
<span class="cp">#define TAR_MODE_O_R      (1 &lt;&lt; 2)</span>
<span class="cp">#define TAR_MODE_G_X      (1 &lt;&lt; 3)</span>
<span class="cp">#define TAR_MODE_G_W      (1 &lt;&lt; 4)</span>
<span class="cp">#define TAR_MODE_G_R      (1 &lt;&lt; 5)</span>
<span class="cp">#define TAR_MODE_U_X      (1 &lt;&lt; 6)</span>
<span class="cp">#define TAR_MODE_U_W      (1 &lt;&lt; 7)</span>
<span class="cp">#define TAR_MODE_U_R      (1 &lt;&lt; 8)</span>
<span class="cp">#define TAR_MODE_RESERVED (1 &lt;&lt; 9)</span>
<span class="cp">#define TAR_MODE_GID_X    (1 &lt;&lt; 10)</span>
<span class="cp">#define TAR_MODE_UID_X    (1 &lt;&lt; 11)</span>
</code></pre></div></td></tr></table></div>

<h3>File type</h3>
<p>The <code>typeflag</code> field contains the type of file, i.e. if it is a file, a directory or a special file.
Our implementation will only support files and directories.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">enum</span><span class="w"> </span><span class="n">tar_type_t</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TAR_TYPE_NORMAL0</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_NORMAL</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_HARD_LINK</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_SYMBOLIC_LINK</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;2&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_CHARACTER_DEVICE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;3&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_BLOCK_DEVICE</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;4&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_DIRECTORY</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;5&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_FIFO</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;6&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">TAR_TYPE_RESERVED</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;7&#39;</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>

<p>When the file is a <em>hard link</em> or a <em>symbolic link</em>, the <code>linkname</code> field specifies the absolute path of what it is linked to.
Note that the linked-to path is limited to 100 characters and does not use the <code>prefix</code>.</p>
<p>When the file is a <em>device file</em>, the <code>devmajor</code> and <code>devminor</code> fields contain the device number, which is used to associate the device to a device driver in a Unix system. Those fields are in octal.</p>
<h3>Modified time</h3>
<p>The date and time of the last time that the file was modified (modified time) is stored in the <code>mtime</code> field as octal. It is simply a <a href="https://en.wikipedia.org/wiki/Unix_time">Unix timestamp</a>, the number of seconds between a particular date and the Unix epoch (January 1st 1970 at UTC).
It can be decoded using a function like this:</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span><span class="c1"> // time_t</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">tar_get_mtime</span><span class="p">(</span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="w"> </span><span class="n">header</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">mtime</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">mtime_timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tar_oct_to_u64</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">mtime</span><span class="p">);</span>
<span class="w">    </span><span class="kt">time_t</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">time_t</span><span class="p">)</span><span class="n">mtime_timestamp</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tm</span><span class="o">*</span><span class="w"> </span><span class="n">time_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timestamp</span><span class="p">);</span>
<span class="w">    </span><span class="n">strftime</span><span class="p">(</span><span class="n">mtime</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time_info</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h3>Checksum</h3>
<p>Finally, the <code>chksum</code> field contains the sum of all bytes in the header in octal. It can be used to validate that the file entry is valid.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">u32</span><span class="w"> </span><span class="nf">tar_compute_checksum</span><span class="p">(</span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="w"> </span><span class="n">header</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">u8</span><span class="o">*</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u8</span><span class="o">*</span><span class="p">)</span><span class="n">header</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">u32</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">tar_file_header_t</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">148</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">148</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">checksum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="sc">&#39; &#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// must count &quot;chksum&quot; as spaces</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">checksum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">checksum</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h2>List</h2>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>tar -tvf [input file]
-t : list
-v : verbose, show progress
-f : specify filename
</code></pre></div></td></tr></table></div>

<p>Listing the files within a tar archive can be done by reading the tar file block by block from the start of the file.</p>
<p>The first header block encountered is the root directory.</p>
<p>When a block is valid (signature is correct).</p>
<p>For a basic utility we can only parse the file path and size.
The size must also be parsed as we need to skip the data blocks to get to the next file.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">u64</span><span class="w"> </span><span class="n">n_data_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAR_BLOCK_SIZE</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TAR_BLOCK_SIZE</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>

<p>This means that we need to know if a file entry is an actual file or something else like a directory.</p>
<p>The other fields can be parsed similarly.</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="c1"> // fopen</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="c1"> // strcmp, strlen, memcpy</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">tar_list</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file_path</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// open file</span>
<span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rb&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ERROR: file &#39;%s&#39; cannot be found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// read file block by block</span>
<span class="w">    </span><span class="n">u8</span><span class="w"> </span><span class="n">block</span><span class="p">[</span><span class="n">TAR_BLOCK_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">tar_read_block</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">block</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="p">)</span><span class="n">block</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// get file metadata</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">file_path</span><span class="p">[</span><span class="mi">256</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">permissions</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">uname</span><span class="p">[</span><span class="mi">32</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">gname</span><span class="p">[</span><span class="mi">32</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">mtime</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">        </span><span class="n">tar_get_file_path</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">);</span>
<span class="w">        </span><span class="n">tar_get_permissions</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">);</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">uname</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-&gt;</span><span class="n">uname</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="n">gname</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-&gt;</span><span class="n">gname</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<span class="w">        </span><span class="n">tar_get_mtime</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="w"> </span><span class="n">mtime</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">);</span>
<span class="w">        </span><span class="n">u64</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tar_oct_to_u64</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// print file metadata</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">((</span><span class="n">tar_type_t</span><span class="p">)</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">typeflag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// file</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">TAR_TYPE_NORMAL0</span><span class="p">:</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">TAR_TYPE_NORMAL</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// skip data blocks</span>
<span class="w">                </span><span class="n">u64</span><span class="w"> </span><span class="n">n_data_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAR_BLOCK_SIZE</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TAR_BLOCK_SIZE</span><span class="p">;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n_data_blocks</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">fseek</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">n_data_blocks</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">TAR_BLOCK_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_CUR</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s %s %s %s %s (%lu bytes)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">uname</span><span class="p">,</span><span class="w"> </span><span class="n">gname</span><span class="p">,</span><span class="w"> </span><span class="n">mtime</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// link</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">TAR_TYPE_HARD_LINK</span><span class="p">:</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">TAR_TYPE_SYMBOLIC_LINK</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
<span class="w">                </span><span class="kt">char</span><span class="w"> </span><span class="n">link_path</span><span class="p">[</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">                </span><span class="n">memcpy</span><span class="p">(</span><span class="n">link_path</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">-&gt;</span><span class="n">linkname</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s %s %s %s %s (%lu bytes) -&gt; %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">uname</span><span class="p">,</span><span class="w"> </span><span class="n">gname</span><span class="p">,</span><span class="w"> </span><span class="n">mtime</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">link_path</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// device</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">TAR_TYPE_CHARACTER_DEVICE</span><span class="p">:</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">TAR_TYPE_BLOCK_DEVICE</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">u64</span><span class="w"> </span><span class="n">devmajor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tar_oct_to_u64</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">devmajor</span><span class="p">);</span>
<span class="w">                </span><span class="n">u64</span><span class="w"> </span><span class="n">devminor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tar_oct_to_u64</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">devminor</span><span class="p">);</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s %s %s %lu.%lu %s %s (%lu bytes)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">uname</span><span class="p">,</span><span class="w"> </span><span class="n">gname</span><span class="p">,</span><span class="w"> </span><span class="n">devmajor</span><span class="p">,</span><span class="w"> </span><span class="n">devminor</span><span class="p">,</span><span class="w"> </span><span class="n">mtime</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">default</span><span class="o">:</span>
<span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s %s %s %s %s (%lu bytes)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="n">uname</span><span class="p">,</span><span class="w"> </span><span class="n">gname</span><span class="p">,</span><span class="w"> </span><span class="n">mtime</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// close file</span>
<span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">tar_read_block</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">u8</span><span class="o">*</span><span class="w"> </span><span class="n">block</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// read block</span>
<span class="w">    </span><span class="n">fread</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">TAR_BLOCK_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">tar_file_header_t</span><span class="o">*</span><span class="p">)</span><span class="n">block</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// check if block is valid</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">tar_is_ustar</span><span class="p">(</span><span class="n">header</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tar_compute_checksum</span><span class="p">(</span><span class="n">header</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checksum</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">tar_oct_to_u64</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">chksum</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<h2>Extract</h2>
<p>On Linux, a tar file can be extracted via the command <code>tar -xvf test.tar -C test/</code>.</p>
<ul>
<li>-x : extract</li>
<li>-v : verbose (show progress)</li>
<li>-f : specify input file</li>
<li>-C : specify output directory</li>
</ul>
<p>Extraction is very similar to listing the files but we must create the files and directories as needed.</p>
<p>The <code>mtime</code> must also be restored, this can be accomplished via the <code>utime</code> syscall:
set mtime</p>
<p>set permissions
set owner, group</p>
<h2>Create</h2>
<p>Creating archives is a little more complicated than extracting them.
The command to create a tar archive is <code>tar --format=ustar -cvf test/ test.tar</code>.</p>
<ul>
<li>-c : create</li>
<li>-v : verbose (show progress)</li>
<li>-f : specify output directory</li>
<li>--format=ustar : specify the "ustar" format since the default is "gnu"</li>
</ul>
<h2>References</h2>
<ul>
<li>Specification:<ul>
<li><a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/tar.h.html">https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/tar.h.html</a></li>
<li><a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html#tag_20_92_13_06">https://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html#tag_20_92_13_06</a></li>
<li><a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html#tag_20_92_18_03">https://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html#tag_20_92_18_03</a></li>
</ul>
</li>
<li>GNU Tar:<ul>
<li><a href="https://www.gnu.org/software/tar/manual/html_node/index.html">https://www.gnu.org/software/tar/manual/html_node/index.html</a></li>
<li><a href="https://www.gnu.org/software/tar/manual/html_node/index.html">https://www.gnu.org/software/tar/manual/html_node/Standard.html#Standard</a></li>
<li><a href="https://www.gnu.org/software/tar/manual/html_node/Formats.html#Formats">https://www.gnu.org/software/tar/manual/html_node/Formats.html#Formats</a></li>
</ul>
</li>
<li>Wiki:<ul>
<li><a href="https://wiki.osdev.org/USTAR">https://wiki.osdev.org/USTAR</a></li>
<li><a href="https://wiki.osdev.org/Tar">https://wiki.osdev.org/Tar</a></li>
<li><a href="https://en.wikipedia.org/wiki/Tar_(computing)">https://en.wikipedia.org/wiki/Tar_(computing)</a></li>
</ul>
</li>
</ul>
        <hr>
        <footer>
            <div>
                <a href="https://github.com/kevenv"><i class='bx bxl-github bx-sm'></i></a>
                <a href="https://www.linkedin.com/in/kevenv"><i class='bx bxl-linkedin-square bx-sm'></i></a>
                <a href="https://twitter.com/keven_v"><i class='bx bxl-twitter bx-sm'></i></a>
                <a href="discord:kevenv"><i class='bx bxl-discord-alt bx-sm'></i></a>
                <a href="mailto:keven.villeneuve@gmail.com"><i class='bx bxs-envelope bx-sm'></i></a>
            </div>
            <p>&copy; 2024 Keven Villeneuve</p>
        </footer>
    </body>
</html>
